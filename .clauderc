# SnapKit GNOME Extension - Development Guide

## Project Overview
SnapKit is a GNOME Shell extension that provides Windows 11-style snap layouts for window tiling. Users can trigger the overlay by moving their mouse to a screen edge (configurable: top, bottom, left, right), select a layout, and assign windows to different zones.

## Project Structure
```
snapkit/
├── Makefile                    # Build automation
├── snapkit@watkinslabs/       # Extension source (UUID-based directory)
│   ├── extension.js           # Main extension entry point
│   ├── prefs.js              # Preferences UI
│   ├── metadata.json         # Extension metadata
│   ├── stylesheet.css        # CSS styling
│   ├── lib/                  # Core functionality
│   │   ├── layoutManager.js  # Manages layout definitions
│   │   ├── overlayUI.js      # Overlay widget and visual presentation
│   │   ├── snapHandler.js    # Window snapping logic
│   │   ├── windowSelector.js # Window selection UI
│   │   └── settings.js       # Settings utilities
│   ├── layouts/
│   │   └── presets.js        # Preset layout definitions
│   └── schemas/
│       └── org.gnome.shell.extensions.snapkit.gschema.xml
├── build/                     # Build output (gitignored)
└── .clauderc                 # This file
```

## Build System
The project uses a Makefile with the following targets:

- `make build` - Compile schemas and create extension package
- `make install` - Install extension to ~/.local/share/gnome-shell/extensions/
- `make uninstall` - Remove installed extension
- `make clean` - Clean build artifacts
- `make reload` - Reload GNOME Shell (X11 only)
- `make tail` - Follow extension logs in journalctl

**Important:** Always run `make build` after making code changes.

## Key Architecture Patterns

### State Management
The extension uses a state machine with three states:
- `CLOSED`: Hitbox visible (or hidden with auto-hide), layout grid hidden
- `OPEN`: Full overlay visible with layout grid
- `SNAP_MODE`: Window selector visible for assigning windows to zones

### Overlay Positioning
- Dynamically adapts to trigger edge setting (top/bottom/left/right)
- Layouts arrange horizontally for top/bottom edges, vertically for left/right edges
- Animations use translation (not position) to prevent cross-monitor drawing
- Corners not touching screen edge are rounded with 12px radius

### Multi-Monitor Support
Three monitor modes available:
- `primary`: Overlay only on primary monitor
- `current`: Overlay follows mouse to current monitor
- `all`: Overlays on all monitors simultaneously

## Common Tasks

### Adding a New Layout Preset
1. Edit `layouts/presets.js`
2. Add layout object with zones (coordinates in 0-1 range)
3. Run `make build && make install`

### Modifying Overlay Appearance
- Main overlay styles: `lib/overlayUI.js` (`_applySettings` method)
- CSS styles: `stylesheet.css`
- Colors are configurable via settings (see schema)

### Debugging
- Enable debug mode in preferences
- View logs: `make tail` or `journalctl -f -o cat /usr/bin/gnome-shell`
- Debug output is prefixed with `SnapKit:` or `SnapKit SnapHandler:`

## Important Implementation Details

### Zone Coordinates
- All zone coordinates are relative (0-1 range)
- `layoutManager.calculateZoneGeometry()` converts to absolute pixels
- Work area (not full monitor) is used to respect panels/docks

### Animation System
- Uses Clutter ease() for smooth animations
- Translation-based sliding prevents overflow to adjacent monitors
- Duration configurable via settings (animation-duration)

### Window Snapping Flow
1. User clicks layout zone → enters SNAP_MODE
2. Window selector shows available windows
3. User selects window → `snapHandler.snapWindow()` called
4. Window is moved/resized to zone geometry
5. Process repeats for remaining zones in layout

### Settings Schema
- All settings in `schemas/org.gnome.shell.extensions.snapkit.gschema.xml`
- Must compile after changes: schemas are compiled during `make build`
- Access in code via `this._settings.get_*()` methods

## Testing Checklist
- [ ] Test on all trigger edges (top, bottom, left, right)
- [ ] Test on all monitor modes (primary, current, all)
- [ ] Test with multiple monitors
- [ ] Test animations don't overflow to adjacent monitors
- [ ] Test window snapping with various window types
- [ ] Test auto-hide functionality
- [ ] Test right-click preferences access

## Common Issues

### Extension Won't Load
- Check `journalctl` for JavaScript errors
- Verify metadata.json shell-version matches current GNOME version
- Ensure schemas are compiled (automatically done by `make build`)

### Windows Not Snapping
- Enable debug mode and check logs
- Verify window allows move/resize (not all windows do)
- Check work area calculation is correct
- Ensure zone coordinates are valid (0-1 range)

### Overlay Positioning Issues
- Verify monitor detection logic in `_getActiveMonitor`
- Check `_positionOverlay` calculations for the specific trigger edge
- Ensure container orientation matches edge (vertical for left/right, horizontal for top/bottom)

## Git Workflow
- Always run `make build` before committing
- Do not commit build artifacts
- Do not mention AI tools in commit messages
- Use descriptive commit messages explaining the "why"

## Resources
- GNOME Shell Extensions: https://gjs.guide/extensions/
- GJS Documentation: https://gjs-docs.gnome.org/
- St (Shell Toolkit): https://gjs-docs.gnome.org/st12/
- Clutter: https://gjs-docs.gnome.org/clutter12/
